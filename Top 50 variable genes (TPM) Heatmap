# Import necessary libraries
import pandas as pd

# Load TPM expression matrix from Excel file
# Rows are genes, columns are samples; set first column as row index
tpm_df = pd.read_excel("Your file path", index_col=0)

# Optional: Transpose if your data has samples in rows and genes in columns
# tpm_df = tpm_df.T

# Display the first few rows of the TPM dataframe
print(tpm_df.head())

# Import visualization libraries
import seaborn as sns
import matplotlib.pyplot as plt

# Calculate variance for each gene across all samples
# Select top 50 most variable genes (high expression variability)
top_genes = tpm_df.var(axis=1).sort_values(ascending=False).head(50).index

# Subset the TPM dataframe to include only the top 50 variable genes
heatmap_data = tpm_df.loc[top_genes]

# Set the figure size for the heatmap
plt.figure(figsize=(12, 12))

# Create a heatmap to visualize expression of top 50 variable genes
ax = sns.heatmap(
    heatmap_data,
    cmap="RdBu",           # Diverging color map: red = low, blue = high (or vice versa)
    xticklabels=True,      # Show sample names
    yticklabels=True,      # Show gene names
    cbar_kws={             # Customize the color bar
        'label': 'TPM Expression',
        'shrink': 0.8,     # Reduce colorbar height
        'aspect': 30       # Adjust aspect ratio of colorbar
    }
)

# Add title and axis labels
plt.title("Heatmap of Top 50 Variable Genes (TPM)", fontsize=14)
plt.xlabel("Samples")
plt.ylabel("Genes")

# Improve layout to prevent overlap
plt.tight_layout()

# Display the heatmap
plt.show()
