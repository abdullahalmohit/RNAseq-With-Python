import pandas as pd

# === Step 1: Load the featureCounts output file ===
# Replace with your actual path
file_path = "SRRXXXXXXXX_counts.txt"

# Read the file, skipping the first comment/header line
df = pd.read_csv(file_path, sep='\t', comment='#')

# === Step 2: Extract necessary columns ===
# Keep: Geneid, Length, and Count column (usually 7th col onward)
# Adjust column index if you have multiple samples
df = df[['Geneid', 'Length', df.columns[-1]]]
df.columns = ['Geneid', 'Length', 'Count']

# === Step 3: Calculate RPK (Reads Per Kilobase) ===
df['RPK'] = df['Count'] / (df['Length'] / 1000)

# === Step 4: Calculate TPM ===
total_RPK = df['RPK'].sum()
df['TPM'] = (df['RPK'] / total_RPK) * 1e6

# === Step 5: Save TPM output ===
df[['Geneid', 'TPM']].to_csv("TPM_expression_data.csv", index=False)

print("TPM calculation completed. Output saved as 'TPM_expression_data.csv'.")
